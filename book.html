<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gold Cinema ‚Äì Booking</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 100%); color:#fff; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; min-height:100vh; }
    
    header { background:linear-gradient(135deg, #d4af37 0%, #f3d15c 100%); color:#111; padding:25px; text-align:center; box-shadow:0 8px 32px rgba(212, 175, 55, 0.3); }
    header h1 { font-size:28px; font-weight:bold; letter-spacing:2px; }

    .main-nav { display:flex; justify-content:center; gap:30px; background:#16213e; padding:15px; flex-wrap:wrap; box-shadow:0 4px 15px rgba(0,0,0,0.5); }
    .nav-link { color:#d4af37; text-decoration:none; font-weight:600; transition:all 0.3s; padding:8px 15px; border-radius:5px; }
    .nav-link:hover, .nav-link.active { background:#d4af37; color:#111; }

    .container { width:95%; max-width:1200px; margin:30px auto; padding:0; }
    .section { background:linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding:30px; border-radius:15px; margin-bottom:25px; box-shadow:0 10px 40px rgba(0,0,0,0.7); border:1px solid rgba(212, 175, 55, 0.2); }
    .section h2 { font-size:22px; margin-bottom:20px; color:#d4af37; text-transform:uppercase; letter-spacing:1px; }
    .section h3 { font-size:16px; margin:15px 0 10px 0; color:#f3d15c; }

    /* SEAT MAP */
    .seat-map { display:grid; grid-template-columns:repeat(auto-fit, minmax(40px, 1fr)); gap:10px; margin:20px 0; max-width:500px; }
    .seat { width:40px; height:40px; border-radius:8px; text-align:center; line-height:40px; cursor:pointer; font-size:12px; font-weight:bold; transition:all 0.3s; border:2px solid transparent; }
    .seat:hover { transform:scale(1.1); }
    .vip { background:linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); box-shadow:0 4px 15px rgba(37, 99, 235, 0.4); }
    .regular { background:linear-gradient(135deg, #1abc9c 0%, #16a085 100%); box-shadow:0 4px 15px rgba(26, 188, 156, 0.4); }
    .student { background:linear-gradient(135deg, #8b5a8f 0%, #5d3a5d 100%); box-shadow:0 4px 15px rgba(139, 90, 143, 0.4); }
    .seat.selected { background:linear-gradient(135deg, #f1c40f 0%, #e8b708 100%); color:#000; border:2px solid #fff; box-shadow:0 0 20px rgba(241, 196, 15, 0.6); transform:scale(1.15); }
    .seat.booked { background:linear-gradient(135deg, #c0392b 0%, #a93226 100%); cursor:not-allowed; opacity:0.6; }

    .legend { display:flex; gap:20px; flex-wrap:wrap; margin:20px 0; padding:15px; background:rgba(0,0,0,0.3); border-radius:10px; }
    .legend-item { display:flex; align-items:center; gap:8px; }
    .legend-box { width:30px; height:30px; border-radius:5px; }

    /* FORMS */
    input, select { width:100%; padding:12px; margin-bottom:15px; border-radius:8px; border:1px solid #d4af37; background:#0f1419; color:#fff; font-size:14px; transition:all 0.3s; }
    input:focus, select:focus { outline:none; border-color:#f3d15c; box-shadow:0 0 15px rgba(212, 175, 55, 0.4); background:#1a1a2e; }
    input::placeholder { color:#888; }

    button { background:linear-gradient(135deg, #d4af37 0%, #f3d15c 100%); color:#111; padding:14px 35px; border:none; border-radius:8px; font-weight:bold; font-size:16px; cursor:pointer; transition:all 0.3s; text-transform:uppercase; letter-spacing:1px; box-shadow:0 6px 20px rgba(212, 175, 55, 0.3); }
    button:hover { transform:translateY(-2px); box-shadow:0 10px 30px rgba(212, 175, 55, 0.5); }
    button:active { transform:translateY(0); }

    .msg { padding:12px 15px; border-radius:8px; margin:15px 0; font-weight:600; }
    #seatMsg { background:rgba(220, 53, 69, 0.2); color:#ff6b6b; border-left:4px solid #ff6b6b; }
    #totalMsg { background:rgba(37, 99, 235, 0.2); color:#66b3ff; border-left:4px solid #2563eb; }
    #finalMsg { background:rgba(26, 188, 156, 0.2); color:#66ffee; border-left:4px solid #1abc9c; }

    .back-btn { background:linear-gradient(135deg, #555 0%, #777 100%); padding:10px 20px; font-size:14px; margin-top:15px; }
    .back-btn:hover { background:linear-gradient(135deg, #777 0%, #999 100%); }

    @media (max-width:768px) {
      .main-nav { flex-direction:column; gap:10px; }
      .section { padding:20px; }
      header h1 { font-size:22px; }
      .seat-map { grid-template-columns:repeat(8, 1fr); }
    }
  </style>
</head>
<body>

<header>
  <h1>üé¨ Gold Cinema</h1>
  <p style="font-size:14px; margin-top:5px;">Premium E-Ticket System</p>
</header>

<nav class="main-nav" aria-label="Main navigation">
  <a href="index.html" class="nav-link">Home</a>
  <a href="#events" class="nav-link">Events</a>
  <a href="register-login.html" class="nav-link">Account</a>
</nav>

<div class="container">
  <!-- SEATING -->
  <div class="section" id="bookingSection">
    <h2>üìç Select Your Seats</h2>
    
    <div class="legend">
      <div class="legend-item"><div class="legend-box vip"></div> VIP (KSh 1,200)</div>
      <div class="legend-item"><div class="legend-box regular"></div> Regular (KSh 700)</div>
      <div class="legend-item"><div class="legend-box student"></div> Student (KSh 350)</div>
    </div>

    <p style="text-align:center; margin:15px 0; font-size:14px; color:#aaa;">üé• SCREEN üé•</p>
    <div class="seat-map" id="seatMap"></div>
    <p id="totalMsg" class="msg"></p>

    <button onclick="goToPayment()">Continue to Payment ‚Üí</button>
    <p id="seatMsg" class="msg" style="display:none;"></p>
  </div>

  <!-- PAYMENT FORM -->
  <div class="section" id="paymentSection" style="display:none;">
    <h2>üí≥ Payment Details</h2>

    <input type="text" id="userName" placeholder="Full Name" required>
    <input type="email" id="userEmail" placeholder="Email Address" required>

    <h3>Select Payment Method</h3>
    <select id="paymentMethod" onchange="renderPaymentFields()">
      <option value="">Choose Payment Method</option>
      <option value="mpesa">üì± M-Pesa</option>
      <option value="card">üí≥ Credit/Debit Card</option>
      <option value="paypal">üÖøÔ∏è PayPal</option>
      <option value="cash">üíµ Cash on Pickup</option>
    </select>

    <div id="paymentFields"></div>

    <button onclick="submitFinalBooking()">‚úì Confirm Booking</button>
    <button class="back-btn" onclick="goBack()">‚Üê Back to Seats</button>
    <p id="finalMsg" class="msg" style="display:none;"></p>
  </div>
</div>

<script>
let selectedSeats = [];
const VIP_PRICE=1200, REG_PRICE=700, STUDENT_PRICE=350;

function renderSeats(){
  const map = document.getElementById("seatMap");
  map.innerHTML = "";
  const rows = "ABCDEFGH".split("");
  rows.forEach((row, rIndex) => {
    for(let n=1; n<=10; n++){
      let seatID = row+n;
      let cls = rIndex<2 ? "vip" : rIndex<6 ? "regular" : "student";
      map.innerHTML += `<div class="seat ${cls}" onclick="toggleSeat('${seatID}', '${cls}')">${seatID}</div>`;
    }
  });
}

function toggleSeat(id, cls){
  let i = selectedSeats.indexOf(id);
  if(i === -1) selectedSeats.push(id);
  else selectedSeats.splice(i, 1);
  document.querySelectorAll('.seat').forEach(seat=>{
    if(seat.innerText === id) seat.classList.toggle("selected");
  });
  calculateTotal();
}

function calculateTotal(){
  let vipCount=0, regCount=0, studentCount=0;
  selectedSeats.forEach(seat=>{
    const row=seat.charAt(0);
    if(row==="A"||row==="B") vipCount++;
    else if(row==="C"||row==="D"||row==="E"||row==="F") regCount++;
    else studentCount++;
  });
  const total=(vipCount*VIP_PRICE)+(regCount*REG_PRICE)+(studentCount*STUDENT_PRICE);
  document.getElementById("totalMsg").innerHTML=
    `${vipCount>0 ? 'üîµ VIP √ó'+vipCount : ''} ${regCount>0 ? 'üü¢ Regular √ó'+regCount : ''} ${studentCount>0 ? 'üü£ Student √ó'+studentCount : ''}<br><strong>Total: KSh ${total.toLocaleString()}</strong>`;
}

function goToPayment(){
  if(selectedSeats.length === 0){
    let msg = document.getElementById("seatMsg");
    msg.style.display="block";
    msg.innerHTML = "‚ö†Ô∏è Select at least one seat.";
    return;
  }
  document.getElementById("bookingSection").style.display = "none";
  document.getElementById("paymentSection").style.display = "block";
}

function goBack(){
  document.getElementById("paymentSection").style.display = "none";
  document.getElementById("bookingSection").style.display = "block";
  document.getElementById("finalMsg").style.display = "none";
}

function renderPaymentFields(){
  const m = document.getElementById("paymentMethod").value;
  const box = document.getElementById("paymentFields");
  if(m === "mpesa"){
    box.innerHTML = `<input type="tel" id="mpesaPhone" placeholder="+254 712 345 678" required>`;
  }
  else if(m === "card"){
    box.innerHTML = `
      <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" required>
      <input type="month" id="cardExpiry" required>
      <input type="text" id="cardCVV" placeholder="123" maxlength="4" required>
    `;
  }
  else if(m === "paypal"){
    box.innerHTML = `<input type="email" id="paypalEmail" placeholder="your@paypal.com" required>`;
  }
  else box.innerHTML = "";
}

function submitFinalBooking(){
  const name = document.getElementById("userName").value;
  const email = document.getElementById("userEmail").value;
  const method = document.getElementById("paymentMethod").value;

  if(!name || !email || !method){
    let msg = document.getElementById("finalMsg");
    msg.style.display="block";
    msg.innerHTML = "‚ö†Ô∏è Fill all required fields.";
    return;
  }

  let vipCount=0, regCount=0, studentCount=0;
  selectedSeats.forEach(seat=>{
    const row=seat.charAt(0);
    if(row==="A"||row==="B") vipCount++;
    else if(row==="C"||row==="D"||row==="E"||row==="F") regCount++;
    else studentCount++;
  });
  const amount=(vipCount*VIP_PRICE)+(regCount*REG_PRICE)+(studentCount*STUDENT_PRICE);

  if(method === "mpesa"){
    const phone = document.getElementById("mpesaPhone").value;
    let payload = { phone, tickets: selectedSeats.length, email, seats: selectedSeats, name, amount };

    fetch("http://localhost:5000/api/book", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    })
    .then(res => res.json())
    .then(data => {
      let msg = document.getElementById("finalMsg");
      msg.style.display="block";
      msg.innerHTML = "‚úì " + data.message;
    })
    .catch(err => {
      let msg = document.getElementById("finalMsg");
      msg.style.display="block";
      msg.innerHTML = "‚ùå Error: " + err;
    });
  } else {
    let msg = document.getElementById("finalMsg");
    msg.style.display="block";
    msg.innerHTML = "‚ö†Ô∏è Currently only M-Pesa STK Push is supported.";
  }
}

renderSeats();
calculateTotal();
</script>

</body>
</html>